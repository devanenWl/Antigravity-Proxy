import{_ as W,a as j,r as v,p as G,b as p,d as s,e as a,g as o,f as n,k as M,F as N,q as D,P,l as u,Q as H,t as r,S as J,T as X,V as Y,o as d,h as K,W as Z}from"./index-CDzEZqfw.js";import{C as h,c as tt}from"./clipboard-BYc1WW6g.js";import{C as et}from"./Card-Cto2nSnp.js";import{B as i}from"./Button-CtfZAKL_.js";import{R as st,B as E}from"./Badge-DoFE7pgC.js";import{I as at}from"./Input-DX0cGwRU.js";import{M as I,P as F,T as U}from"./Modal-DwxlxhjF.js";import{P as $}from"./plus-BE-yyuUG.js";import{E as q,a as L}from"./eye-Boct3wEI.js";const lt={class:"api-keys-page"},ot={class:"page-header"},nt={class:"page-actions"},it={class:"table"},rt={class:"key-name"},ut={class:"key-cell"},dt={class:"action-buttons"},vt={key:0},ft={colspan:"7",class:"empty-cell"},ct={class:"empty-state"},mt={class:"card-list-view"},pt={class:"key-header"},yt={class:"key-card-name"},gt={class:"key-value"},Ct={class:"key-actions-inline"},_t={class:"key-stats"},kt={class:"stat-item"},wt={class:"stat-value"},zt={class:"stat-item"},Kt={class:"stat-value"},At={class:"key-actions"},Vt={key:0,class:"empty-state mobile-empty"},bt={class:"warning-box"},Pt={class:"new-key-display"},ht={class:"confirm-text"},It={__name:"ApiKeys",setup($t){const f=j(),y=v([]),g=v(!1),A=v(!1),c=v(!1),k=v(!1),C=v(!1),_=v(null),w=v(""),V=v(""),z=async()=>{var l;g.value=!0;try{const t=await J();y.value=(((l=t.data)==null?void 0:l.keys)||t.keys||[]).map(e=>({...e,showKey:!1}))}catch{f.error("加载API密钥失败")}finally{g.value=!1}},R=async()=>{var l;A.value=!0;try{const t=await X(w.value||"新密钥");V.value=((l=t.data)==null?void 0:l.key)||t.key,c.value=!1,k.value=!0,w.value="",z()}catch{f.error("创建API密钥失败")}finally{A.value=!1}},x=async l=>{const t=l.status==="active"?"disabled":"active";try{await Z(l.id,t),l.status=t,f.success("状态更新成功")}catch{f.error("状态更新失败")}},T=l=>{_.value=l,C.value=!0},O=async()=>{if(_.value)try{await Y(_.value.id),f.success("API密钥已删除"),C.value=!1,_.value=null,z()}catch{f.error("删除API密钥失败")}},b=async l=>{await tt(l)?f.success("API密钥已复制"):f.error("复制失败，请手动复制")},B=l=>l?l.slice(0,7)+"..."+l.slice(-4):"",S=l=>l>=1e6?(l/1e6).toFixed(1)+"M":l>=1e3?(l/1e3).toFixed(1)+"K":String(l),Q=l=>l?new Date(l).toLocaleString():"-";return G(z),(l,t)=>(d(),p("div",lt,[s("div",ot,[t[12]||(t[12]=s("h1",{class:"page-title"},"API 密钥",-1)),s("div",nt,[a(i,{variant:"primary",onClick:t[0]||(t[0]=e=>c.value=!0)},{default:o(()=>[a(n($),{size:16}),t[11]||(t[11]=s("span",{class:"hide-mobile"},"创建密钥",-1))]),_:1}),a(i,{variant:"ghost",onClick:z,loading:g.value},{default:o(()=>[a(n(st),{size:16})]),_:1},8,["loading"])])]),a(et,{class:"table-card table-responsive",padding:!1},{default:o(()=>[s("table",it,[t[15]||(t[15]=s("thead",null,[s("tr",null,[s("th",null,"名称"),s("th",null,"API 密钥"),s("th",null,"状态"),s("th",null,"请求数"),s("th",null,"Token数"),s("th",null,"最后使用"),s("th",null,"操作")])],-1)),s("tbody",null,[(d(!0),p(N,null,D(y.value,e=>(d(),p("tr",{key:e.id},[s("td",null,[s("span",rt,r(e.name),1)]),s("td",null,[s("div",ut,[s("code",null,r(e.showKey?e.key:B(e.key)),1),a(i,{variant:"ghost",size:"sm",icon:"",onClick:m=>e.showKey=!e.showKey},{default:o(()=>[e.showKey?(d(),K(n(q),{key:0,size:14})):(d(),K(n(L),{key:1,size:14}))]),_:2},1032,["onClick"]),a(i,{variant:"ghost",size:"sm",icon:"",onClick:m=>b(e.key)},{default:o(()=>[a(n(h),{size:14})]),_:1},8,["onClick"])])]),s("td",null,[a(E,{variant:e.status==="active"?"success":"default",dot:""},{default:o(()=>[u(r(e.status),1)]),_:2},1032,["variant"])]),s("td",null,r(e.request_count||0),1),s("td",null,r(S(e.token_count||0)),1),s("td",null,r(Q(e.last_used_at)),1),s("td",null,[s("div",dt,[a(i,{variant:"ghost",size:"sm",icon:"",onClick:m=>x(e)},{default:o(()=>[a(n(F),{size:14})]),_:1},8,["onClick"]),a(i,{variant:"ghost",size:"sm",icon:"",onClick:m=>T(e)},{default:o(()=>[a(n(U),{size:14})]),_:1},8,["onClick"])])])]))),128)),y.value.length===0&&!g.value?(d(),p("tr",vt,[s("td",ft,[s("div",ct,[a(n(P),{size:40}),t[14]||(t[14]=s("p",null,"暂无API密钥",-1)),a(i,{variant:"primary",size:"sm",onClick:t[1]||(t[1]=e=>c.value=!0)},{default:o(()=>[a(n($),{size:14}),t[13]||(t[13]=u(" 创建密钥 ",-1))]),_:1})])])])):M("",!0)])])]),_:1}),s("div",mt,[(d(!0),p(N,null,D(y.value,e=>(d(),p("div",{key:e.id,class:"key-card"},[s("div",pt,[s("span",yt,r(e.name),1),a(E,{variant:e.status==="active"?"success":"default",dot:""},{default:o(()=>[u(r(e.status),1)]),_:2},1032,["variant"])]),s("div",gt,[s("code",null,r(e.showKey?e.key:B(e.key)),1),s("div",Ct,[a(i,{variant:"ghost",size:"sm",icon:"",onClick:m=>e.showKey=!e.showKey},{default:o(()=>[e.showKey?(d(),K(n(q),{key:0,size:14})):(d(),K(n(L),{key:1,size:14}))]),_:2},1032,["onClick"]),a(i,{variant:"ghost",size:"sm",icon:"",onClick:m=>b(e.key)},{default:o(()=>[a(n(h),{size:14})]),_:1},8,["onClick"])])]),s("div",_t,[s("div",kt,[t[16]||(t[16]=s("span",{class:"stat-label"},"请求数",-1)),s("span",wt,r(e.request_count||0),1)]),s("div",zt,[t[17]||(t[17]=s("span",{class:"stat-label"},"Token数",-1)),s("span",Kt,r(S(e.token_count||0)),1)])]),s("div",At,[a(i,{variant:"ghost",size:"sm",onClick:m=>x(e)},{default:o(()=>[a(n(F),{size:14}),u(" "+r(e.status==="active"?"禁用":"启用"),1)]),_:2},1032,["onClick"]),a(i,{variant:"ghost",size:"sm",onClick:m=>T(e)},{default:o(()=>[a(n(U),{size:14})]),_:1},8,["onClick"])])]))),128)),y.value.length===0&&!g.value?(d(),p("div",Vt,[a(n(P),{size:48}),t[19]||(t[19]=s("p",null,"暂无API密钥",-1)),a(i,{variant:"primary",onClick:t[2]||(t[2]=e=>c.value=!0)},{default:o(()=>[a(n($),{size:16}),t[18]||(t[18]=u(" 创建密钥 ",-1))]),_:1})])):M("",!0)]),a(I,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=e=>c.value=e),title:"创建 API 密钥",width:"400px"},{footer:o(()=>[a(i,{variant:"ghost",onClick:t[4]||(t[4]=e=>c.value=!1)},{default:o(()=>[...t[20]||(t[20]=[u("取消",-1)])]),_:1}),a(i,{variant:"primary",loading:A.value,onClick:R},{default:o(()=>[...t[21]||(t[21]=[u("创建",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(at,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e),label:"名称",placeholder:"我的API密钥"},{icon:o(()=>[a(n(P),{size:16})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),a(I,{modelValue:k.value,"onUpdate:modelValue":t[8]||(t[8]=e=>k.value=e),title:"API 密钥已创建",width:"500px"},{footer:o(()=>[a(i,{variant:"primary",onClick:t[7]||(t[7]=e=>k.value=!1)},{default:o(()=>[...t[24]||(t[24]=[u("完成",-1)])]),_:1})]),default:o(()=>[s("div",bt,[a(n(H),{size:20}),t[22]||(t[22]=s("span",null,"请立即复制您的API密钥，之后将无法再次查看！",-1))]),s("div",Pt,[s("code",null,r(V.value),1),a(i,{variant:"primary",onClick:t[6]||(t[6]=e=>b(V.value))},{default:o(()=>[a(n(h),{size:16}),t[23]||(t[23]=u(" 复制 ",-1))]),_:1})])]),_:1},8,["modelValue"]),a(I,{modelValue:C.value,"onUpdate:modelValue":t[10]||(t[10]=e=>C.value=e),title:"删除 API 密钥",width:"400px"},{footer:o(()=>[a(i,{variant:"ghost",onClick:t[9]||(t[9]=e=>C.value=!1)},{default:o(()=>[...t[27]||(t[27]=[u("取消",-1)])]),_:1}),a(i,{variant:"danger",onClick:O},{default:o(()=>[...t[28]||(t[28]=[u("删除",-1)])]),_:1})]),default:o(()=>{var e;return[s("p",ht,[t[25]||(t[25]=u(" 确定要删除 ",-1)),s("strong",null,r((e=_.value)==null?void 0:e.name),1),t[26]||(t[26]=u(" 吗？ ",-1))]),t[29]||(t[29]=s("p",{class:"confirm-warning"},"此操作无法撤销。",-1))]}),_:1},8,["modelValue"])]))}},Ut=W(It,[["__scopeId","data-v-83a9491e"]]);export{Ut as default};
