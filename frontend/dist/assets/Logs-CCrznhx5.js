import{c as C,_ as T,a as V,r as g,a1 as k,a2 as q,p as N,b as d,d as t,e as l,j as y,a3 as b,F as w,q as z,g as m,f as _,t as o,k as D,a4 as I,l as f,a5 as M,a6 as R,o as u}from"./index-CDzEZqfw.js";import{C as U}from"./Card-Cto2nSnp.js";import{B as h}from"./Button-CtfZAKL_.js";import{R as $,B as j}from"./Badge-DoFE7pgC.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=C("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=C("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),A={class:"logs-page"},G={class:"page-header"},H={class:"page-actions"},J=["value"],O={class:"stats-row"},P={class:"mini-stat"},Q={class:"mini-stat-value"},W={class:"mini-stat"},X={class:"mini-stat-value"},Y={class:"mini-stat"},Z={class:"mini-stat-value success"},tt={class:"mini-stat"},st={class:"mini-stat-value"},et={class:"table"},at={class:"model-name"},ot={class:"token-info"},nt={class:"token-total"},lt=["title"],it={key:1},rt={key:0},dt={colspan:"7",class:"empty-cell"},ut={class:"empty-state"},ct={class:"pagination"},pt={class:"page-info"},mt={__name:"Logs",setup(vt){const x=V(),c=g([]),i=g({}),v=g(!1),L=["gemini-2.5-flash","gemini-2.5-pro","gemini-3-pro-high","gemini-3-pro-low","claude-opus-4-5","claude-opus-4-5-thinking","claude-sonnet-4-5","claude-sonnet-4-5-thinking"],r=k({model:"",status:""}),a=k({page:1,size:50,total:0}),p=async()=>{var n;v.value=!0;try{const s={limit:a.size,offset:(a.page-1)*a.size,model:r.model||void 0,status:r.status||void 0},e=await M(s);c.value=((n=e.data)==null?void 0:n.logs)||e.logs||[],a.total=c.value.length<a.size?(a.page-1)*a.size+c.value.length:a.page*a.size+1}catch{x.error("加载日志失败")}finally{v.value=!1}},B=async()=>{var n;try{const s=Date.now(),e=await R({start_time:s-24*60*60*1e3,end_time:s});i.value=((n=e.data)==null?void 0:n.stats)||e.stats||{}}catch(s){console.error("Failed to load stats",s)}},S=n=>new Date(n).toLocaleString(),F=n=>n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":String(n);return q(r,()=>{a.page=1,p()}),N(()=>{p(),B()}),(n,s)=>(u(),d("div",A,[t("div",G,[s[6]||(s[6]=t("h1",{class:"page-title"},"请求日志",-1)),t("div",H,[y(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>r.model=e),class:"filter-select"},[s[4]||(s[4]=t("option",{value:""},"全部模型",-1)),(u(),d(w,null,z(L,e=>t("option",{key:e,value:e},o(e),9,J)),64))],512),[[b,r.model]]),y(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>r.status=e),class:"filter-select"},[...s[5]||(s[5]=[t("option",{value:""},"全部状态",-1),t("option",{value:"success"},"成功",-1),t("option",{value:"error"},"失败",-1)])],512),[[b,r.status]]),l(h,{variant:"ghost",onClick:p,loading:v.value},{default:m(()=>[l(_($),{size:16})]),_:1},8,["loading"])])]),t("div",O,[t("div",P,[t("span",Q,o(i.value.total_requests||0),1),s[7]||(s[7]=t("span",{class:"mini-stat-label"},"请求数 (24h)",-1))]),t("div",W,[t("span",X,o(F(i.value.total_tokens||0)),1),s[8]||(s[8]=t("span",{class:"mini-stat-label"},"Token数",-1))]),t("div",Y,[t("span",Z,o(i.value.total_requests>0?(i.value.success_count/i.value.total_requests*100).toFixed(1):100)+"% ",1),s[9]||(s[9]=t("span",{class:"mini-stat-label"},"成功率",-1))]),t("div",tt,[t("span",st,o(Math.round(i.value.avg_latency||0))+"ms",1),s[10]||(s[10]=t("span",{class:"mini-stat-label"},"平均延迟",-1))])]),l(U,{class:"table-card",padding:!1},{default:m(()=>[t("table",et,[s[12]||(s[12]=t("thead",null,[t("tr",null,[t("th",null,"时间"),t("th",null,"模型"),t("th",null,"账号"),t("th",null,"状态"),t("th",null,"Token数"),t("th",null,"延迟"),t("th",null,"错误")])],-1)),t("tbody",null,[(u(!0),d(w,null,z(c.value,e=>(u(),d("tr",{key:e.id},[t("td",null,o(S(e.created_at)),1),t("td",null,[t("span",at,o(e.model),1)]),t("td",null,o(e.account_email||"-"),1),t("td",null,[l(j,{variant:e.status==="success"?"success":"error"},{default:m(()=>[f(o(e.status),1)]),_:2},1032,["variant"])]),t("td",null,[t("span",ot,o(e.prompt_tokens)+" → "+o(e.completion_tokens),1),t("span",nt,"("+o(e.total_tokens)+")",1)]),t("td",null,o(e.latency_ms)+"ms",1),t("td",null,[e.error_message?(u(),d("span",{key:0,class:"error-text",title:e.error_message},o(e.error_message),9,lt)):(u(),d("span",it,"-"))])]))),128)),c.value.length===0&&!v.value?(u(),d("tr",rt,[t("td",dt,[t("div",ut,[l(_(I),{size:40}),s[11]||(s[11]=t("p",null,"暂无日志",-1))])])])):D("",!0)])])]),_:1}),t("div",ct,[l(h,{variant:"ghost",size:"sm",disabled:a.page<=1,onClick:s[2]||(s[2]=e=>{a.page--,p()})},{default:m(()=>[l(_(E),{size:16}),s[13]||(s[13]=f(" 上一页 ",-1))]),_:1},8,["disabled"]),t("span",pt,"第 "+o(a.page)+" 页",1),l(h,{variant:"ghost",size:"sm",disabled:c.value.length<a.size,onClick:s[3]||(s[3]=e=>{a.page++,p()})},{default:m(()=>[s[14]||(s[14]=f(" 下一页 ",-1)),l(_(K),{size:16})]),_:1},8,["disabled"])])]))}},kt=T(mt,[["__scopeId","data-v-06c2cf7c"]]);export{kt as default};
